#!/bin/bash

# This script will open or switch to the open 'scratch' writing directory and if
# needed open up the scratch.txt file in vim for quick editing.

scratch_path="/Users/greg/Writing/Scratch"

not_in_tmux() {
  [ -z "$TMUX" ]
}

scratch_session_exists() {
  tmux has-session -t "Scratch"
}

create_detached_session() {
  (TMUX='' tmux new-session -c "$scratch_path" -Ad -s "Scratch")
}

create_if_needed_and_attach() {
  if not_in_tmux; then
    tmux start-server
    create_detached_session
    tmux attach-session -t "Scratch" \; set-buffer "vim scratch.txt" \; paste-buffer \; send-keys C-m
  else
    if scratch_session_exists; then
      tmux switch-client -t "Scratch"
    else
      create_detached_session
      tmux switch-client -t "Scratch"
      cd ~/Writing/Scratch
    fi
  fi
}

create_if_needed_and_attach
